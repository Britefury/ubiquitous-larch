ccopy_reg
_reconstructor
p0
(clarch.worksheet.worksheet
Worksheet
p1
c__builtin__
object
p2
Ntp3
Rp4
(dp5
S'blocks'
p6
(lp7
g0
(clarch.worksheet.worksheet
WorksheetBlockText
p8
g2
Ntp9
Rp10
(dp11
S'worksheet'
p12
g4
sS'text'
p13
V<h1>Interactive visuals using d3.js</h1><p>In this worksheet, we will demonstrate the creation of interactive visuals with d3.js.</p><h2>Live Computation</h2><p>First, we need to cover some of the live computations primitives provided by Ubiquitous Larch.</p>
p14
sbag0
(clarch.worksheet.worksheet
WorksheetBlockCode
p15
g2
Ntp16
Rp17
(dp18
g12
g4
sS'code'
p19
g0
(clarch.python
PythonCode
p20
g2
Ntp21
Rp22
(dp23
g19
V# First, we need to import LiveValue and LiveFunction\u000afrom britefury.live.live_value import LiveValue\u000afrom britefury.live.live_function import LiveFunction\u000a\u000a\u000a# A quick test:\u000a# Create a live value containing the value 0\u000ax = LiveValue(0)\u000a\u000a# Display it\u000ax
p24
sS'editable'
p25
I01
sbsbag0
(g8
g2
Ntp26
Rp27
(dp28
g12
g4
sg13
V<p>A <code>LiveValue</code> is&nbsp;displayed as the value it contains. If we create a button that increments the value:</p>
p29
sbag0
(g15
g2
Ntp30
Rp31
(dp32
g12
g4
sg19
g0
(g20
g2
Ntp33
Rp34
(dp35
g19
Vfrom britefury.pres.controls.button import button\u000a\u000adef on_click():\u000a    x.value = x.value + 1\u000a\u000ab = button('Increment', on_click)\u000a\u000ab
p36
sg25
I01
sbsbag0
(g8
g2
Ntp37
Rp38
(dp39
g12
g4
sg13
V<p>Notice that clicking it updates the value of the <code>LiveValue</code> displayed above.</p><p>A <code>LiveFunction</code> computes its value using a function. It's displayed value is automatically updated when any LiveValues that are accessed by it, are modified:</p>
p40
sbag0
(g15
g2
Ntp41
Rp42
(dp43
g12
g4
sg19
g0
(g20
g2
Ntp44
Rp45
(dp46
g19
V# We can define a live function by definiting the function, then creating the live function:\u000adef _x_squared():\u000a    return x.value * x.value\u000a\u000ax_squared = LiveFunction(_x_squared)\u000a\u000a# Or we can use it as a decorator; this is neater:\u000a@LiveFunction\u000adef x_squared():\u000a    return x.value * x.value\u000a\u000a# Display it\u000ax_squared
p47
sg25
I01
sbsbag0
(g8
g2
Ntp48
Rp49
(dp50
g12
g4
sg13
V<p>Notice that incrementing <code>x</code> with the 'Increment' button modifies both values.</p><h2>Interactive visuals</h2><p>Now, we will create an interactive bar-chart. This time round, the Javascript function that generates the chart takes the data in as a parameter, rather than going via a URL.</p><p>First, the code to create the chart:</p>
p51
sbag0
(g15
g2
Ntp52
Rp53
(dp54
g12
g4
sg19
g0
(g20
g2
Ntp55
Rp56
(dp57
g19
V# We need random\u000aimport random\u000a\u000a# We need Html further down\u000afrom britefury.pres.html import Html\u000a\u000a\u000a\u000a\u000a\u000a# First, we define some javascript code to display our chart.\u000a# This code was adapted from the bar chart example from the d3.js website.\u000a# This time\u000abar_chart_js = """\u000afunction init_chart(node, data, bar_width, bar_height) {\u000a    // Scales for our chart: X and Y\u000a	var x = d3.scale.linear()\u000a        .domain([0, 1])\u000a        .range([0, bar_width]);\u000a    \u000a    var y = d3.scale.linear()\u000a        .domain([0, 100])\u000a        .rangeRound([0, bar_height]);\u000a\u000a	// Get a reference to the chart DOM node; passed as the first argument\u000a    var chart = d3.select(node);\u000a    \u000a	// Define the bars\u000a    chart.selectAll("rect")\u000a        .data(data)\u000a	   .enter().append("rect")\u000a        .attr("x", function(d, i) { return x(i) - .5; })\u000a        .attr("y", function(d) { return bar_height - y(d) - .5; })\u000a        .attr("width", bar_width)\u000a        .attr("height", function(d) { return y(d); });\u000a\u000a}\u000a"""\u000a\u000a# CSS styles to define the appearance of the chart\u000abar_chart_css = """\u000a.chart rect {\u000a  fill: steelblue;\u000a  stroke: white;\u000a}"""\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a
p58
sg25
I01
sbsbag0
(g8
g2
Ntp59
Rp60
(dp61
g12
g4
sg13
V<p>Now, create <code>LiveValues</code>&nbsp;containing the mean and standard deviation:</p>
p62
sbag0
(g15
g2
Ntp63
Rp64
(dp65
g12
g4
sg19
g0
(g20
g2
Ntp66
Rp67
(dp68
g19
Vmean = LiveValue(50.0)\u000astandard_deviation = LiveValue(10.0)
p69
sg25
I01
sbsbag0
(g8
g2
Ntp70
Rp71
(dp72
g12
g4
sg13
V<p>Now create a <code>LiveFunction</code> that generates the chart:</p>
p73
sbag0
(g15
g2
Ntp74
Rp75
(dp76
g12
g4
sg19
g0
(g20
g2
Ntp77
Rp78
(dp79
g19
V# Now, we define a live function that generates the data and a chart\u000a@LiveFunction\u000adef live_chart():\u000a    # Generate the data:\u000a    data = [random.gauss(mean.value, standard_deviation.value)   for i in xrange(33)]\u000a    \u000a    # Generate the chart in the same way that we did in the previous worksheet:\u000a    chart = Html('<svg class="chart" width=660 height=80></svg>')\u000a    chart = chart.js_function_call('init_chart', data, 20, 80)\u000a    chart = chart.use_js(source=bar_chart_js).use_css(source=bar_chart_css)\u000a    chart = chart.use_js('/d3.v3.min.js')\u000a    \u000a    return chart
p80
sg25
I01
sbsbag0
(g8
g2
Ntp81
Rp82
(dp83
g12
g4
sg13
V<p>The slider controls:</p>
p84
sbag0
(g15
g2
Ntp85
Rp86
(dp87
g12
g4
sg19
g0
(g20
g2
Ntp88
Rp89
(dp90
g19
V# We need the slider control\u000afrom britefury.pres.controls.slider import live_slider\u000a\u000a# Create the sliders\u000amean_slider = live_slider(mean, True, options={'min': 10.0, 'max': 90.0})\u000astdev_slider = live_slider(standard_deviation, True, options={'min': 0.0, 'max': 30.0})\u000a\u000a# Put them in a table\u000asliders = Html('<table><tr><td>Mean:</td><td width="400">', mean_slider, '</td><tr><td>Standard deviation:</td><td width="400">', stdev_slider, '</td></tr></table>')
p91
sg25
I01
sbsbag0
(g8
g2
Ntp92
Rp93
(dp94
g12
g4
sg13
V<p>Now, combine the chart with the sliders (try dragging the sliders to modify the chart):</p>
p95
sbag0
(g15
g2
Ntp96
Rp97
(dp98
g12
g4
sg19
g0
(g20
g2
Ntp99
Rp100
(dp101
g19
V# Arrange the sliders below the chart\u000ainteractive_chart = Html('<div>', live_chart, '</div><div>', sliders, '</div>')\u000a\u000a# And display:\u000ainteractive_chart
p102
sg25
I01
sbsbasb.